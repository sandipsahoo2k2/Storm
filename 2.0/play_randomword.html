<!DOCTYPE html>
<html>
<head>
   <title>Cows & Bulls</title>
   	<meta name="viewport" content="width=device-width, initial-scale=1">
   	<link rel="stylesheet" href="js/jquery.mobile-1.3.2.min.css">
	<script src="js/jquery-1.8.3.min.js"></script>
	<script src="js/jquery.mobile-1.3.2.min.js"></script>
	<script src="js/wordizy_common.js"></script>
</head>
<body>

<div data-role="page" id="pageone">

	<div data-role="header" data-position="fixed">
		<h1>Wordizy</h1>
	</div><!-- /header -->

	<div data-role="content" id="content_id" align="center">
			<div id="hint_content_div" align="center" style='overflow:auto;height:100px'>
			</div>
			<div id="button_groups">
				<div id="randomword_placeholder" data-role="controlgroup" data-type="horizontal"></div>

				<div data-role="controlgroup" data-type="horizontal" data-mini="true">
					<input type = "button" id="delete_characters" data-icon="delete" data-iconpos="notext">
					<input type = "button" id="display_hint" data-icon="info" data-iconpos="notext">
					<input type = "button" id="reveal_chracters" data-icon="star" data-iconpos="notext">
					<input type = "button" id="back_chracters" data-icon="back" data-iconpos="notext">
				</div>

				<div id="key_board1" data-role="controlgroup" data-type="horizontal">
						  <input type = "button" id="key_0" data-mini="true" value= "#" onclick="on_key_clicked(event)">
						  <input type = "button" id="key_1" data-mini="true" value= "#" onclick="on_key_clicked(event)">
						  <input type = "button" id="key_2" data-mini="true" value= "#" onclick="on_key_clicked(event)">
						  <input type = "button" id="key_3" data-mini="true" value= "#" onclick="on_key_clicked(event)">
						  <input type = "button" id="key_4" data-mini="true" value= "#" onclick="on_key_clicked(event)">
						  <input type = "button" id="key_5" data-mini="true" value= "#" onclick="on_key_clicked(event)">
				</div>
				<div id="key_board2" data-role="controlgroup" data-type="horizontal">
						  <input type = "button" id="key_6" data-mini="true" value= "#" onclick="on_key_clicked(event)">
						  <input type = "button" id="key_7" data-mini="true" value= "#" onclick="on_key_clicked(event)">
						  <input type = "button" id="key_8" data-mini="true" value= "#" onclick="on_key_clicked(event)">
						  <input type = "button" id="key_9" data-mini="true" value= "#" onclick="on_key_clicked(event)">
						  <input type = "button" id="key_10" data-mini="true" value= "#" onclick="on_key_clicked(event)">
						  <input type = "button" id="key_11" data-mini="true" value= "#" onclick="on_key_clicked(event)">
				</div>
	  		</div>
    </div><!-- /content -->

		<div data-role="footer" data-position="fixed">
			<h4>Wordizy</h4>
		</div><!-- /footer -->
</div><!-- /page -->

    <script>
    	var to_key_from_key_map = {};
		var random_number = getRandomNum(1, true);
		while(random_number < 3)
		{
			random_number = getRandomNum(1, true);
		}
		var random_word_object = new Object();
		getRandomWordRawData(random_number,random_number);
		var user_input_array = getContainerHTML(random_number, "randomword_placeholder");

		function fillKeyBoard()
		{
			var temp_key_map = {};
			for(i = 0; i < 12;)
			{
				var rand_number_lessthan26 = Math.floor(Math.random() * 26 + 1);
				if(!temp_key_map[rand_number_lessthan26] && rand_number_lessthan26 < 26)
				{
					var keyid = "#key_" + i;
					temp_key_map[rand_number_lessthan26] = keyid;
					var rand_number_lessthan26_text = "" + ENGLISH_LETTER[rand_number_lessthan26];;
					$(keyid).val(rand_number_lessthan26_text);
					$(keyid).button('refresh');
					i++;
				}
			}
		}

		function fillKeyBoardWithWord()
		{
			var tempWord = random_word_object.word;
			var temp_key_map = {};
			for(i = 0; i < tempWord.length;)
			{
				var rand_number_lessthan12 = Math.floor(Math.random() * 12 + 1);
				if(!temp_key_map[rand_number_lessthan12] && rand_number_lessthan12 < 12)
				{
					var keyid = "#key_" + rand_number_lessthan12;
					temp_key_map[rand_number_lessthan12] = keyid;
					var rand_number_lessthan12_text = "" + tempWord.charAt(i);
					$(keyid).val(rand_number_lessthan12_text);
					$(keyid).button('refresh');
					i++;
				}
			}
		}

		function on_key_clicked(event)
		{
			var element = event.srcElement;
			input_char = element.value;
			can_update = false;
			for(index_to_update = 0, i = 0; i < user_input_array.length; i++)
			{
				if(!user_input_array[i])
				{
					index_to_update = i;
					can_update = true;
					break;
				}
			}
			if(can_update && index_to_update <= random_word_object.word.length)
			{
				user_input_array[index_to_update] = true;
				button_id = "#container_key_" + index_to_update;
				from_id = "#" + element.id;
				swap_char(from_id, button_id);
				to_key_from_key_map[button_id] = from_id;
			}
		}

		function on_container_key_clicked(event)
		{
			var element = event.srcElement;
			var source_id = "#"+ element.id;
			delete_char = element.value;
			to_key_id = to_key_from_key_map[source_id];
			if(to_key_id)
			{
				swap_char(source_id, to_key_id);
				to_key_from_key_map[source_id] = null;

				indexDeleted = source_id.replace("#container_key_","");
				indexDeleted = parseInt(indexDeleted);
				user_input_array[indexDeleted] = false;
			}
		}

		function swap_char(fromID, toID)
		{
			valTo = $(toID).val();
			valFrom = $(fromID).val();
			$(fromID).val(valTo);
			$(toID).val(valFrom);
			//$(fromID).button('enable');
			//$(toID).button('disable');
			$(fromID).button('refresh');
			$(toID).button('refresh');
		}

        function setRandomWord(aWord) {
            if (typeof (Storage) !== "undefined") {
                    sessionStorage.random_word = aWord;
                }
            else {
                alert("Browser doesn't support session data ! Crome recomended");
            }
        }

		$(document).on("pageshow","#pageone",function(event){
			var heightOfWindow = $(window).height();
			var totalHeightOfButtons = $("#button_groups").height();
			var leftForHint = heightOfWindow - totalHeightOfButtons;
			$('#hint_content_div').height(leftForHint / 2);

		   $("#display_hint").click(function(event) {
				/*var element = document.getElementById("randomword");
				if(element)
				{
					element.innerHTML = random_word_object.word;
				}*/
				random_word_object.meaning.toHTML("hint_content_div");
				//$( "#level_list" ).refresh();
		   		//$( "#hint_panel" ).panel("open");
		   	});
		});

		function getRandomWordRawData(minLength, maxLength)
		{
			var minMaxString = "&minLength=" + minLength + "&maxLength=" + maxLength;
			var queryString = "randomWord?hasDictionaryDef=true&minCorpusCount=0&maxCorpusCount=-1&minDictionaryCount=1&maxDictionaryCount=-1" + minMaxString;
			var requestURLString = BASE_API_URL + "words.json/" + queryString + API_KEY;

			$.getJSON(requestURLString,
						function(data){
							var random_word = formatRandomWord(data);
							random_word_object.word = random_word.toUpperCase();
							random_word_object.word_size = random_word.length;
							getWordDefinition(random_word);
			});
		}

		function getWordDefinition(inputWord)
		{
			var queryString = inputWord + "/definitions?limit=5&includeRelated=false&sourceDictionaries=all&useCanonical=false&includeTags=false";
			var requestURLString = BASE_API_URL + "word.json/" + queryString + API_KEY;

			$.getJSON(requestURLString,
						function(data){
					var wordDefinition = formatWordMeaning(data);
					random_word_object.meaning = wordDefinition;

					fillKeyBoard();
					fillKeyBoardWithWord();

				});
		}

    </script>
</body>
</html>
