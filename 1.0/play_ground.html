<!DOCTYPE html>
<html>
<head>
	<title>Cows And Bulls</title>

	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css">
	<script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
</head>

<div data-role="page" id="play_ground">
	<div data-role="header" align="center" data-position="fixed">
		<h1 id="header_string">Play Ground</h1>
		<a data-rel="back" data-icon="arrow-l">Back</a> <!-- Here you add the data-rel -->
		<a href="#keyboard" data-rel="popup" id="display_keyboad" data-transition="flip" data-role="button" data-icon="grid" data-iconpos="right" class="ui-btn-right" data-position-to="window">keyboard</a>
	</div>

<br><br><br>

	<div data-role="content" id="page_content">
		<ul data-role="listview">
		</ul>
		<div id="are_you_lost" align="center" data-role="popup">
		          <h3 class="ui-bar ui-bar-b">Are You Lost ?</h3>
				  	      <div class="ui-body ui-body-b">
				  	          <p> <h3> There is a keyboard for you at upper right corner !
		          </br>Click it and start playing.</br></hr>
      	   </div>
    </div>
	</div><!-- /content -->


	<div data-role="footer" id="id_footer" data-position="fixed">
	<div data-role="controlgroup" data-type="horizontal" class="ui-btn-left">
		<input type = "button" data-icon="delete" id="game_quit" value= "Quit">
		<input type = "button" id="total_tries" value= "Tries : 0" >
		</div>
		<input type = "button" id="total_time" value= "00.00" class="ui-btn-right">
		<h4 id="footer_string"></h4>
	</div>


	<div id="keyboard" data-role="popup" data-arrow="l,t">
		<div class="ui-grid-solo" data-theme="e">
		    <div class="ui-block-a"><input type="button" value="0" id="display_button"></div>
		</div>
		<div class="ui-grid-b">
			<div class="ui-block-a"><input type="button" value="1" onclick="update_display_button(event)"></div>
			<div class="ui-block-b"><input type="button" value="2" onclick="update_display_button(event)"></div>
			<div class="ui-block-c"><input type="button" value="3" onclick="update_display_button(event)"></div>
		</div><!-- /grid-b -->
		<div class="ui-grid-b">
				<div class="ui-block-a"><input type="button" value="4" onclick="update_display_button(event)"></div>
				<div class="ui-block-b"><input type="button" value="5" onclick="update_display_button(event)"></div>
				<div class="ui-block-c"><input type="button" value="6" onclick="update_display_button(event)"></div>
		</div><!-- /grid-b -->
		<div class="ui-grid-b">
				<div class="ui-block-a"><input type="button" value="7" onclick="update_display_button(event)"></div>
				<div class="ui-block-b"><input type="button" value="8" onclick="update_display_button(event)" ></div>
				<div class="ui-block-c"><input type="button" value="9" onclick="update_display_button(event)"></div>
		</div><!-- /grid-b -->
		<div class="ui-grid-b">
				<div class="ui-block-a"><input type="button" value="0" onclick="update_display_button(event)"></div>
				<div class="ui-block-b"><input type="button" value="C" id="id_clear"></div>
				<div class="ui-block-c"><input type="button" value="K" id="id_send"></div>
		</div><!-- /grid-b -->
	</div>

</div><!-- /page -->

<div data-role="dialog" id="dialogpage" data-close-btn="none">

	 <div data-role="header">
	    <h1>You made it !!!</h1>
	  </div>

	  <div data-role="content" align="center">
	    <p id="total_tries_taken">Total number of </p>
	    <p id="total_time_taken">Total Time Taken </p>
	    <div data-role="controlgroup" data-type="horizontal">
	    <a href="level_list.html" data-ajax="false" data-role="button">Play Again</a>
	    <a href="" data-role="button">Exit</a>
	    </div>
	  </div>

	  <div data-role="footer">
	    <h1>Congratulations !</h1>
  </div>
</div><!-- /page -->


<script>

	$(document).on("pageinit", "#dialogpage", function(event){
		var element = document.getElementById("total_tries_taken");
		element.innerHTML += " <span 'color:blue;font-weight:bold'>" + $("#total_tries").val() + "</span>";

		element = document.getElementById("total_time_taken");
		element.innerHTML += " <span 'color:blue;font-weight:bold'>" + $("#total_time").val() + "</span>" + " Minutes";

		});


		$("#are_you_lost").on("tap",function(event){
				  $("#are_you_lost").popup( "close" );
		});


var guess_total_time_in_second = 0 ;
var timer_initialised = false;
var are_you_lost_initialised = false;

if(!sessionStorage.user_name)
{
	window.location = "home.html";
}
else
{
	sessionStorage.total_tries = 0 ;
	var guess_total_time = 0 ;
	var element = document.getElementById("footer_string");
	element.innerHTML += " <span 'color:blue;font-weight:bold'>" + sessionStorage.user_name + "</span>" ;
}

function updateTime()
{
	guess_total_time_in_second ++;
	total_minutes = Math.floor(guess_total_time_in_second / 60);
	total_seconds = Math.floor(guess_total_time_in_second % 60);
	total_hours = Math.floor(total_minutes / 60);

	if(total_seconds < 10)
	{
		total_seconds = "0" + total_seconds;
	}
	if(total_minutes < 10)
	{
		total_minutes = "0" + total_minutes;
	}

	if(total_hours > 0)
	{
		$("#total_time").val(" " + total_hours + "." + total_minutes + "." + total_seconds + " ");
	}
	else
	{
		$("#total_time").val(" " + total_minutes + "." + total_seconds + " ");
	}
	$("#total_time").button('refresh');
}


$( "#keyboard" ).bind({
   popupafterclose: function(event, ui) {
		clearDisplayButton();
   }
});

$("#play_ground").on("tap",function(event){
			if(!are_you_lost_initialised)
			{
			  $("#are_you_lost").popup( "open" );
				are_you_lost_initialised = true;
			  }
	});

function clearDisplayButton()
{
	$("#display_button").val("0");
	$("#display_button").button('refresh');
}

function updateTries()
{
	$("#total_tries").val("Tries : " + sessionStorage.total_tries);
	$("#total_tries").button('refresh');
}

$(document).on("pageinit", "#play_ground", function(event){
	var maxHeight = $( window ).height() - 60 + "px";
		var random_no = getRandomNum(sessionStorage.game_level);
		//$.mobile.changePage('result.html', 'pop', false, true);

		$("#id_send").click(function()
		{
			var displayString = $("#display_button").val();
			var inputNumber = parseInt(displayString);
			if(displayString.length == sessionStorage.game_level && displayString != "0" && inputNumber != NaN)
			{
				var bulls_and_cows = getCowsAndBulls(inputNumber, random_no);
				var li_element_to_append = "<li>" + displayString + "<span class='ui-li-count'> Bulls " + bulls_and_cows[0] + " Cows " + bulls_and_cows[1] + "</span></li>";

				if(bulls_and_cows[0] == sessionStorage.game_level)
				{
					$.mobile.changePage('#dialogpage', 'pop', false, true);
				}
				else
				{
					sessionStorage.total_tries ++;
					updateTries();
				}

				$("ul").append(li_element_to_append);
				$( "ul" ).listview( "refresh");
				clearDisplayButton();
				$("#keyboard").popup( "close" );
			}

		});

		$("#id_clear").click(function()
		{
			clearDisplayButton();
		});

		$("#display_keyboad").click(function()
		{
			if(timer_initialised == false)
			{
				setInterval('updateTime()',1000);
				timer_initialised = true;
			}
		});
});

function update_display_button(event)
{
var element = event.srcElement;
input_string = element.value;
 var displayString = $("#display_button").val();
 if(displayString == "0")
 {
  	$("#display_button").val(input_string);
 }
 else if(displayString.length < sessionStorage.game_level)
 {
	 displayString += input_string;
	 $("#display_button").val(displayString);
 }
 $("#display_button").button('refresh');
}

function getRandomNum(number_of_digit)
{
	var random_number = 0;
	if(number_of_digit > 0)
	{
		var temp = Math.random();
		var hundreds = Math.pow(10, number_of_digit);
		random_number = Math.floor(temp * hundreds + 1);
		//alert("random Number is :" + random_number);
	}
	return random_number;
}

function getArrayNum(any_num)
{
    var string_arr = any_num.toString().split("");
    var int_arr = new Array(string_arr.length);
    for (var i in string_arr)
    {
    	int_arr[i] = parseInt(string_arr[i], 10);
    }
    //alert("Number is :" + int_arr);
    return int_arr;
}

function getCowsAndBulls(input_number, random_number)
{
	var input_number = getArrayNum(input_number);
	var random_number = getArrayNum(random_number);

	var bulls_and_cows = [0,0];
	var i=0 ;
	if(random_number.length == input_number.length)
	{
		for(; i < random_number.length; i++)
		{
			if(input_number[i] == random_number[i])
			{
				bulls_and_cows[0]++;
			}
		}

		for(i=0 ; i < random_number.length; i++)
		{
			if(input_number[i] != random_number[i])
			{
				if(random_number.indexOf(input_number[i]) > -1)
				{
					bulls_and_cows[1]++;
				}
			}
		}
		//alert("Bulls : " + bulls_and_cows[0] + " And Cows : " + bulls_and_cows[1]);
	}
	else
	{
		alert("Number of digits of the input should not be more than :" + random_number.length);
	}
	return bulls_and_cows;
}

</script>

</body>
</html>